# matrix button 示例工程

> matrix button示例工程展示了XRadio SDK的矩阵按键扫描用例。
>
> 本工程中提供以下示例：
> 1. 矩阵按键获取按键值用例。（备注：矩阵按键的键值，高16位代表按键的行坐标，低16位代表按键的列坐标）

---

## 适用平台

> 本工程适用以下芯片类型：
> 1. XR872系列芯片：XR872AT、XR872ET

> 本工程适用以下评估板类型：
> 1. 底板：XR872_EVB_AI
> 2. 模组：XR872AT_MD01

> 本工程在基于“XR872AT_MD01”的“XR872_EVB_AI”板上测试通过。
> 若需要在其他适用芯片和评估板上运行本工程，请根据快速指南《XRADIO_Quick_Start_Guide-CN》的提示进行相关配置修改。

> XRadio Wireless MCU芯片和评估板的更多信息可在以下地址获取：
> <https://docs.xradiotech.com>

## 工程配置

> localconfig.mk：
> * N/A
>
> Makefile：
> * N/A
>
> board_config.h
> * N/A
>
> board_config.c
> * g_matrix_buttons_row：必选项，配置矩阵按键的行IO
> * g_matrix_buttons_col：必选项，配置矩阵按键的列IO
>
> prj_config.h
>
> * PRJCONF_PM_EN：必选项，使能pm，让矩阵按键可换醒休眠中的芯片。
>
> * PRJCONF_UART_EN：可选项，使能串口，打印按键键值信息。
>
> * PRJCONF_CONSOLE_EN：可选项，配置使用控制台功能，用于调试。

## 模块依赖

> 必选项
> 1. hal_gpio.c：gpio驱动
> 2. matrix_buttons_low_level.c：矩阵按键底层驱动

---

## 工程说明

> 本工程代码需要配合`board_config.c`来使用，`board_config.c`中保存了矩阵按键的行列IO配置信息。本工程使用的`board_config.c`的路径为：`project/common/board/xr872_evb_ai/board_config.c`。

### 操作说明

> 1. 连接矩阵按键（4*4）到板子中，列IO分别为：A8 A9 A10 A11；行IO分别为：A0 A1 A2 A3。
> 2. 编译工程，烧录镜像，重启即可
> 3. 打开串口调试工具，并连接串口
> 4. 系统启动后，按下矩阵按键上的按键，串口打印按下按键的键值

> XRadio SDK的编译、烧写等操作方式的说明可在以下地址获取：
> <https://docs.xradiotech.com>

### 控制命令

> N/A


### 代码结构
```
.
├── gcc
│   ├── localconfig.mk # 本工程的配置选项，主要用于覆盖默认全局配置
│   └── Makefile       # 本工程的编译规则，可指定src、lib、ld、image.cfg、board_config等文件
├── image
│   └── xr872
├── main.c             # 本工程的入口，示例代码
├── prj_config.h       # 本工程的配置选项，主要用于功能的选择。
└── readme.md          # 本工程的说明文档

#本程用到XRadio SDK的其他配置文件
.
└── project
    └── common
        └── board
            └── xr872_evb_ai           #本工程在makefile中指定使用xr872_evb_ai的板级配置
                ├── board_config.h     #本工程的板级配置
                └── board_config.c     #本工程的板级pin mux的配置。
```
### 代码流程

> 1. 初始化底层矩阵按键模块。
> 2. 创建线程并等待按键的信号量，有新的按键按下时，按键驱动会产生中断并释放信号量。
> 3. 循环调用获取键值接口，不断扫描按键，直到所有按键都释放了才停止扫描。

## 常见问题

   > 问：矩阵按键驱动最大支持多少按键

   答：最大支持16*16的矩阵按键，即最多支持256个按键。

> 问：矩阵按键的键值代表什么

   答：为了更方便的计算和表示按键信息，矩阵按键驱动采用一个32位的数表示键值，分为高16位和低16位，高16位代表行，低16位代表列。比如第1行第1列则可用0x0001,0001，第2行第2列可以用0x0002,0002表示。0x0000,0000表示所有按键都处于释放状态。第1行第1列的按键和第2行第2列的按键同时按下时，可用0x0003,0003表示。

> 问：矩阵按键连接后按下无反应

   答：矩阵按键驱动的扫描方式、IO配置方式，和外部按键硬件电路紧密相连。不同的外部电路，驱动也会不同，所以矩阵按键驱动不是通用的。本示例工程中的矩阵按键驱动只适用于行列直接和IO相连的电路，外部不需要任何电阻器件。其他电路都可能使得按键无法触发中断或者无法正确取得按键值。

## 参考文档

   > 无